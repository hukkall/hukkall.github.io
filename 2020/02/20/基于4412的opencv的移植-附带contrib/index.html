<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="C/C++/C#">
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        基于4412的opencv的移植(附带contrib) - FouRod
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> doRuoF </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpg">
        </div>
        <div class="name">
            <i>AaJal</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li>
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li>
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li>
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#平台"><span class="toc-text">平台</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用的工具"><span class="toc-text">使用的工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#问题"><span class="toc-text">问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解决过程："><span class="toc-text">解决过程：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-下载所需软件以及源代码"><span class="toc-text">1. 下载所需软件以及源代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-使用cmake-gui进行交叉编译"><span class="toc-text">2. 使用cmake-gui进行交叉编译</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-编译文件"><span class="toc-text">3.编译文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-移植到开发板上"><span class="toc-text">4. 移植到开发板上</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-虚拟机编译设置"><span class="toc-text">5. 虚拟机编译设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-测试与简化"><span class="toc-text">6. 测试与简化</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input">
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> doRuoF </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        基于4412的opencv的移植(附带contrib)
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2020-02-20 19:55:33</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#嵌入式" title="嵌入式">嵌入式</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#软件移植" title="软件移植">软件移植</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>

    </div>
    <div class="post-content ">
        <h4 id="平台"><a href="#平台" class="headerlink" title="平台"></a>平台</h4><ol>
<li>UP-Tech 4412</li>
<li>Kubuntu 18.04LTS 64位</li>
</ol>
<h4 id="使用的工具"><a href="#使用的工具" class="headerlink" title="使用的工具"></a>使用的工具</h4><ol>
<li>2013版的交叉编译工具(arm-2013.05-24-arm-none-linux-gnueabi)</li>
<li>opencv_3.4.9</li>
<li>opencv_contrib_3.4.9</li>
<li>cmake-gui</li>
</ol>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ol>
<li>放假之前用的虚拟机被我删除了，里面的文件都没了。</li>
<li>开发板的文件系统被我折腾坏了</li>
<li>需要重新移植opencv</li>
</ol>
<h4 id="解决过程："><a href="#解决过程：" class="headerlink" title="解决过程："></a>解决过程：</h4><h5 id="1-下载所需软件以及源代码"><a href="#1-下载所需软件以及源代码" class="headerlink" title="1. 下载所需软件以及源代码"></a>1. 下载所需软件以及源代码</h5><p>​        首先下载好我们需要使用到的各个文件，他们的下载链接如下所示：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arm-<span class="number">2013.05</span>-<span class="number">24</span>-arm-none-linux-gnueabi		链接：http:<span class="regexp">//pan</span>.baidu.com/<span class="keyword">s</span>/<span class="number">1</span>i3gNttF</span><br><span class="line">opencv_3.<span class="number">4.9</span>	链接：https:<span class="regexp">//github</span>.com/opencv/opencv/archive/<span class="number">3.4</span>.<span class="number">9</span>.tar.gz</span><br><span class="line">opencv_contrib_3.<span class="number">4.9</span> 链接：https:<span class="regexp">//github</span>.com/opencv/opencv_contrib/archive/<span class="number">3.4</span>.<span class="number">9</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>至于cmake-gui的话，如果你使用的是ububtu，直接在终端输入<code>sudo apt install cmake-gui</code>即可。</p>
<p>将交叉编译器解压好，这里我的是<code>/home/gukki/baidunetdiskdownload/arm-2013.05/</code></p>
<p>将下载并解压好的两份源代码放在同一个目录。</p>
<h5 id="2-使用cmake-gui进行交叉编译"><a href="#2-使用cmake-gui进行交叉编译" class="headerlink" title="2. 使用cmake-gui进行交叉编译"></a>2. 使用cmake-gui进行交叉编译</h5><p>​        打开cmake，如下图所示：（只截取了上半部分）</p>
<p><img src="/../img/image-20200220202805847.png" alt="image-20200220202805847"></p>
<p>​        第一行是要求你输入你的opencv的源代码的绝对路径，在这里我的路径是<code>/home/gukki/OpenCv/Source_Code/opencv-3.4.9</code>，第二行要求你填写配置好的源代码的保存路径。在这里，我的是<code>/home/gukki/OpenCv/Process_Code</code>。</p>
<p>​        填写完毕之后点击<code>Configure</code>，cmake要求你选择编译工具，由于我们是交叉编译，我们选择最后一项。点击下一步之后如下图所示：</p>
<p><img src="/../img/image-20200220203339941.png" alt="image-20200220203339941"></p>
<p>​        其中<code>Operating System</code>顾名思义，操作系统，我们的开发板上用的是Linux，就写上吧。</p>
<p><code>C</code>要求你指定好交叉编译器的C编译器，也就是arm-gcc的所在地。</p>
<p><code>C++</code>同理，也是要求你填上arm-g++的所在地，而<code>Target Root</code>填写上你交叉编译器的目录。</p>
<p>​        填写完成之后点击完成。</p>
<p>​        配置完成之后应该会是一片红色，并且左下角的文本显示区域有一句<code>Configuring done</code>。</p>
<p>我们对我们的需求进行对opencv的裁剪：</p>
<blockquote>
<p>在搜索栏区域输入JPEG,勾选上<code>BUILD_JPEG</code>  </p>
<p>输入PNG,勾选上<code>BULID_PNG</code></p>
<p>输入nonfree，勾选上</p>
<p>输入gtk，取消勾选，因为我们用不上图形界面</p>
<p>输入zlib，勾选上</p>
<p>输入extra，在<code>Value</code>一栏上点击右边的三个点，定位好你的<code>opencv_contrib</code>的<code>moudules</code>文件夹。</p>
<p>输入prefix，输入你想安装到的文件夹路径。等会<code>make install</code>时会安装到这里。    </p>
</blockquote>
<p>​        配置完成之后点击<code>Configure</code>，此时你应该要下载一些有关附加模块的一些文件，可能需要很久，等不及的就不去配置extra。下载完成之后，可以再次对额外模块进行裁剪，根据你的需求来定。裁剪完成之后，再次点击<code>Configure</code>，应该不会出现红色了。</p>
<p>点击<code>Generate</code>生成工程文件。  </p>
<h5 id="3-编译文件"><a href="#3-编译文件" class="headerlink" title="3.编译文件"></a>3.编译文件</h5><p>​        进入你的配置好的源代码的文件夹，在此处打开终端，输入<code>make</code>开始编译，根据自身虚拟机配置情况，可在后面加上<code>-j线程数</code>这个参数，我给虚拟机分配了8个核心，所以我编译速度比较快，只用了5分钟左右。如果你什么都没加，预计时间可能是半小时到一小时左右。中间可能有些警告，无须理会。只要没停下来就好。</p>
<p><img src="/../img/image-20200220210124846.png" alt="image-20200220210124846"></p>
<p>可以看到处理器是被吃满的。  </p>
<p>​        编译完成后输入<code>make install</code>，可能需要你加个<code>sudo</code>什么的….</p>
<p>​        安装完成之后可以去设定的<code>prefix</code>文件夹去看看。应该长这样：</p>
<p><img src="/../img/image-20200220210712344.png" alt="image-20200220210712344"></p>
<p>​        其中<code>lib</code>里面是我们编译好的库文件，使用<code>file</code>命令查看类型：</p>
<p><img src="/../img/image-20200220210841342.png" alt="image-20200220210841342"></p>
<p>​        成功了大半了！</p>
<h5 id="4-移植到开发板上"><a href="#4-移植到开发板上" class="headerlink" title="4. 移植到开发板上"></a>4. 移植到开发板上</h5><p>​        将<code>lib</code>文件夹里面的所有文件全部传到开发板的<code>/lib</code>，目录下面，使用<code>nfs</code>速度会快很多。</p>
<p>​        由于我们使用了较新版本的<code>arm_gcc</code>编译工具链，我们还需要把交叉编译工具链里面的<code>libstdc++.so,libstdc++.so.6,libstdc++6.0.17</code>一起复制过去并覆盖。他们位于<code>arm-2013.05/arm-none-linux-gnueabi/libc/usr/lib/</code>这个地方。</p>
<h5 id="5-虚拟机编译设置"><a href="#5-虚拟机编译设置" class="headerlink" title="5. 虚拟机编译设置"></a>5. 虚拟机编译设置</h5><p>​        为了让虚拟机知道opecv的头文件和库文件的位置，我们需要借助一个叫做<code>pkg-config</code> 的软件， 安装也是可以用<code>apt</code>来安装的。我们找到opencv库文件夹里面的pkgconfig文件夹，打开你的shell的配置文件，我使用的是<code>zsh</code>所以打开<code>.zshrc</code>加入以下的两句话句话：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PKG_CONFIG_PATH=<span class="regexp">/home/gukki</span><span class="regexp">/OpenCv/</span>_Install/<span class="class"><span class="keyword">lib</span>/<span class="title">pkgconfig</span>/:$<span class="title">PKG_CONFIG_PATH</span></span></span><br><span class="line">export PKG_CONFIG_PATH</span><br></pre></td></tr></table></figure>

<p>​        自行替换你的pkgconfig文件夹位置。</p>
<p>​        使用<code>source</code>命令让更改生效，输入<code>pkg-config --cflags --libs opencv</code>，应该会出现一大坨东西，如下所示：</p>
<p><img src="/../img/image-20200220212101215.png" alt="image-20200220212101215"></p>
<h5 id="6-测试与简化"><a href="#6-测试与简化" class="headerlink" title="6. 测试与简化"></a>6. 测试与简化</h5><p>​        写一个非常简单的程序，来测试下吧：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Mat m;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        保存为<code>T.cpp</code>，使用如下命令进行编译：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm-none-linux-gnueabi-g++ `pkg-config --cflags --libs opencv` T.cpp -lpthread -lrt -ldl</span><br></pre></td></tr></table></figure>

<p>​        应该只有一个警告，不需要理会。</p>
<p>​        生成的<code>a.out</code>文件拷贝到开发板，给予权限。运行之后应该什么效果都没有，也没有任何报错。那就是行了。你可以试试更加复杂的程序了。但是不能有任何跟界面有关的函数出现比如<code>imshow</code>，<code>waitkey</code>等等，否则会报错。（因为我裁剪掉了）你也可以自行尝试如何让他们使用，有更好的想法可以告诉我！</p>
<p>​        每次编译都要打那么长的代码，有没有方法可以简化？</p>
<p>​        可以使用<code>alias</code>命令来进行简化，我的就是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias armcv="arm-none-linux-gnueabi-g++ `pkg-config --cflags --libs opencv` -lpthread -ldl -lrt"</span><br></pre></td></tr></table></figure>

<p>​        同样的，写到你自己的shell的配置文件里面。</p>
<p>​        完-</p>
<p>​        </p>

        
        <br>
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud" target="_blank" rel="external nofollow noopener noreferrer">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


    <script>
        /**
         *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
         *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
        */
        if( '' || '')
        var disqus_config = function () {
            this.page.url = '';  // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };

        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://dadala.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>



</html>
